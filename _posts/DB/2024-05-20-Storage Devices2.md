---
title: Storage Devices(2)
date: 2024-05-20 13:09
category: DB
tags: [Magnetic Disks, RAID, File Organization]
summary: In this section, we will look at computer storage devices. Because database systems store and manage data, knowledge of data storage devices is necessary to understand database systems. We will discuss the characteristics of each storage device, the characteristics of hard disks, the most common medium for storing data, RAID, and the file and record structures and buffers in computer systems. 
toc: true
toc_sticky: true
---

Storage Devices(1)에서는 물리적 저장 매체의 분류와 저장 계층 구조, 자기 디스크의 특징 등을 살펴보았습니다. 이번 글에서는 이어서 자기 디스크의 <span style="background-color:#fff5b1">성능 평가</span>와 <span style="background-color:#fff5b1">향상 방법</span>에 대해 알아보고, <span style="background-color:#fff5b1">RAID</span>와 <span style="background-color:#fff5b1">File Organization</span>에 대해 살펴보겠습니다.

# 디스크 성능 평가

Performance Measures of Disks는 다음과 같은 세 가지 측정 항목으로 평가됩니다.

**1. 접근 시간 (Access Time)**<br>
    읽기/쓰기 요청이 발행된 시점 ~ 데이터 전송이 시작될 때까지 걸리는 시간.
- **탐색 시간(Seek Time) + 회전 지연 시간(Rotational Latency)**
  - **탐색 시간 (Seek Time):** 읽기/쓰기 헤드가 올바른 트랙으로 이동하는 데 걸리는 시간.
    - 일반적인 디스크에서는 4~10밀리초.
  - **회전 지연 시간 (Rotational Latency):** 디스크의 섹터가 헤드 아래로 올 때까지의 회전 시간.
    - 일반적인 디스크에서는 4~11밀리초 (5400~15000 RPM).
- **총 접근 시간:** 일반적으로 15~20밀리초.
{: .notice}

**2. 데이터 전송 속도 (Data-Transfer Rate)**<br>
    디스크에서 데이터를 읽거나 쓸 때의 속도.
- **외곽 트랙이 더 높은 전송 속도를 가지며, 내부 트랙은 더 낮은 전송 속도를 가짐** (외곽 트랙이 더 긴 거리를 이동하기 때문).
    - 일반적으로 디스크의 바깥쪽에 있는 트랙은 디스크가 회전할 때 더 많은 데이터를 읽고 쓸 수 있어서 전송 속도가 빠르고, <br>안쪽에 있는 트랙은 데이터를 읽고 쓸 수 있는 양이 적어서 전송 속도가 느립니다.
- **속도 예시:**
  - SATA: 150 MB/sec
  - SATA II (3Gb/s): 300 MB/sec
  - SATA III (6Gb/s): 600 MB/sec
  - Ultra 320 SCSI: 320 MB/sec
  - SAS: 3~6 Gb/sec
  - Fiber Channel (FC 2Gb 또는 FC 4Gb): 256~512 MB/sec
{: .notice}

**3. 평균 무고장 시간 (MTTF, Mean Time to Failure)**<br>
    디스크가 고장 없이 계속 동작할 것으로 예상되는 평균 시간.
- **새 디스크의 고장 확률**은 낮으며, 이론적인 MTTF는 500,000~1,200,000시간 (57~136년).
  - 예시: MTTF가 1,200,000시간인 새 디스크 1000개 중 하나는 평균적으로 1200시간 (50일)마다 고장 발생.
- 디스크가 오래될수록 MTTF는 감소.
- 일반 수명은 보통 3~5년 정도
{: .notice}

# 디스크 성능 향상

자기 디스크는 다른 저장 매체에 비해 접근 속도가 느린 단점이 있습니다. 이를 극복하기 위해 여러 가지 기법을 지원하고 있습니다. 디스크 성능을 향상시키는 주요 기법들을 다음과 같이 정리할 수 있습니다.

**1. 블록 단위 데이터 접근**
- **블록 (Block):** 디스크의 데이터를 읽거나 쓰는 최소 단위.
    - 블록은 단일 track의 연속적인 sector로 구성된 데이터 단위입니다.
- **특징:** 
  - 데이터는 디스크와 메인 메모리 사이에서 블록 단위로 전송됩니다.
  - 작은 블록: 더 많은 전송이 필요하지만, 각 전송의 데이터 양이 적어 데이터 접근이 빠릅니다.
  - 큰 블록: 부분적으로 채워진 블록으로 인해 공간 낭비가 증가할 수 있지만, 한 번에 많은 데이터를 전송할 수 있습니다.
  - 일반적인 블록 크기: 4~16KB
{: .notice}

**2. Disk-Arm-Scheduling Algorithms**<br>
    disk arm의 이동을 최소화하기 위해 트랙에 대한 접근 요청을 정렬하는 알고리즘입니다. 이 알고리즘은 disk arm이 가장 가까운 요청을 먼저 처리하도록 하여 효율성을 높입니다.
  - **엘리베이터 알고리즘:** disk arm이 엘리베이터처럼 위아래로 움직이며, 가장 가까운 요청을 먼저 처리합니다. 이 알고리즘은 disk arm 이동을 최적화하여 접근 시간을 줄입니다.
{: .notice}

**3. 데이터 집약화(clustering)**<br>
    데이터 접근 시간을 최적화하기 위해 관련 데이터를 물리적으로 근접한 위치에 저장하는 방법입니다. 논리적으로 가까운 데이터를 같은 실린더나 인접 실린더에 저장하여 접근 시간을 줄입니다.
- **특징:**
  - 같은 실린더나 인접 실린더에 관련 정보를 저장합니다.
  - 시간이 지나면서 파일이 조각화될 수 있으며, 이로 인해 disk arm 이동이 증가할 수 있습니다.
  - **디스크 조각 모음 유틸리티**를 사용하여 파일 시스템을 정리하고 최적화할 수 있습니다.
{: .notice}

**4. 비휘발성 쓰기 버퍼 (Nonvolatile Write Buffers)**<br>
    비활성 RAM에 쓰기 연산을 우선 하게 하여 쓰기 연산에 따른 기다림을 없애는 방식입니다.
- **특징:**
  - 데이터베이스 작업이 디스크에 데이터를 안전하게 저장하기 전까지 계속 진행될 수 있습니다.
  - disk arm 이동을 최소화하기 위해 쓰기 작업을 재정렬할 수 있습니다.
{: .notice}

**5. 로그 디스크 (Log Disk)**<br>
    블록 업데이트의 순차 로그를 쓰는 전용 디스크입니다. 순차적인 데이터 쓰기만 수행하므로 탐색 시간이 필요 없으며, 데이터 접근 성능이 향상됩니다.
- **특징:**
  - 로그 디스크에 쓰기는 탐색 시간이 필요 없어 매우 빠릅니다.
  - 특별한 하드웨어(NV-RAM)가 필요하지 않습니다.
  - **저널링 파일 시스템**: 로그 디스크를 지원하며, 성능 향상을 위해 디스크 쓰기를 재정렬합니다.
{: .notice}

# RAID

RAID(Redundant Array of Independent Disks, 독립 디스크의 중복 배열)는 여러 개의 하드 드라이브를 하나의 논리적인 유닛으로 결합하여 데이터 저장의 성능, 안정성, 또는 용량을 향상시키는 기술입니다. RAID는 데이터를 여러 디스크에 분산시켜 시스템의 신뢰성과 성능을 높이는 것을 목표로 합니다.

RAID에는 여러 가지 레벨이 있으며, 각각 성능, 신뢰성, 저장 효율성 등의 측면에서 다양한 특성을 갖고 있습니다. RAID 0, 1, 2, 3, 4, 5, 6을 설명하면 다음과 같습니다:

---
**RAID 0** <br>
RAID 0은 데이터를 여러 **디스크에 분산하여 저장함으로써 성능을 극대화**하는 방식입니다. 이를 데이터 <span style="background-color:#fff5b1">스트라이핑(Data Striping)</span>이라고 하며, 데이터가 각 디스크에 순차적으로 나누어져 저장되기 때문에 읽기 및 쓰기 속도가 매우 빠릅니다. 
그러나 RAID 0에는 데이터 보호 기능이 전혀 없어서, 하나의 디스크라도 고장 나면 모든 데이터가 손실됩니다. 따라서 RAID 0은 주로 성능이 중요한 애플리케이션에서 사용되며, 데이터 손실 위험을 감수할 수 있는 경우에 적합합니다.

**RAID 1** <br>
RAID 1은 <span style="background-color:#fff5b1">미러링(Mirroring)</span> 방식을 사용하여 **데이터를 두 개 이상의 디스크에 동일하게 복제**합니다. 모든 쓰기 작업은 두 디스크에 동일하게 수행되며, 읽기 작업은 어느 디스크에서든 가능합니다. 이로 인해 하나의 디스크가 고장 나더라도 다른 디스크에서 데이터를 복구할 수 있어 높은 신뢰성을 제공합니다. 그러나 저장 공간의 효율성이 낮아서, 사용 가능한 저장 공간이 절반으로 줄어들게 됩니다. RAID 1은 데이터 보호가 중요한 애플리케이션에 주로 사용됩니다.

**RAID 2** <br>
RAID 2는 <span style="background-color:#fff5b1">**비트** 수준 스트라이핑(Bit-Level Striping)</span>과 <span style="background-color:#fff5b1">해밍 코드(Hamming Code)</span>를 사용하여 오류를 검출하고 수정합니다. 각 바이트의 **비트**를 여러 디스크에 나누어 저장하고, 오류 검출 및 수정용 해밍 코드를 추가하여 신뢰성을 높입니다. 
RAID 2는 RAID 0과 RAID 1에 비해 데이터 오류 검출 및 수정 기능을 통해 데이터 신뢰성을 크게 향상시킨 기술입니다. RAID 2는 데이터를 비트 수준으로 여러 디스크에 스트라이핑하고, 각 디스크에 오류 검출 및 수정을 위한 해밍 코드를 추가로 저장합니다.
> 예를 들어, 8개의 디스크가 있는 경우, 각 바이트의 비트를 8개의 디스크에 분산 저장하고, 별도의 디스크에 해밍 코드를 저장합니다. 이 방식은 **데이터 전송 속도를 높이면서도 데이터의 무결성을 유지할 수 있습니다.**

RAID 2는 이론적으로 오류 검출과 수정 기능을 제공하지만, 구현이 복잡하고 비용이 많이 들기 때문에 현재는 거의 사용되지 않습니다. 초기 RAID 시스템에서 사용되었으나, 다른 RAID 레벨로 대체되었습니다.

**RAID 3** <br>
RAID 3은 <span style="background-color:#fff5b1">**바이트** 수준 스트라이핑(Byte-Level Striping)</span>과 별도의 <span style="background-color:#fff5b1">패리티 디스크</span>를 사용하여 데이터를 보호합니다. 데이터가 **바이트** 단위로 여러 디스크에 스트라이핑되며, 패리티 정보는 전용 디스크에 저장됩니다. 이 방식은 높은 데이터 전송 속도를 제공하지만, 패리티 디스크가 병목 현상을 일으킬 수 있습니다. RAID 3는 연속 데이터 전송이 중요한 애플리케이션에서 주로 사용됩니다.

**RAID 4** <br>
RAID 4는 <span style="background-color:#fff5b1">**블록** 수준 스트라이핑(Block-Level Striping)</span>과 별도의 <span style="background-color:#fff5b1">패리티 디스크</span>를 사용합니다. 데이터가 블록 단위로 여러 디스크에 스트라이핑되며, 패리티 정보는 전용 디스크에 저장됩니다. RAID 4는 RAID 3보다 더 일반적인 I/O 작업에 적합하지만, 패리티 디스크가 병목 현상을 일으킬 수 있다는 단점이 있습니다. 데이터 읽기와 쓰기가 균형 있게 중요한 애플리케이션에서 사용됩니다.

**RAID 5** <br>
RAID 5는 데이터를 <span style="background-color:#fff5b1">**블록** 수준으로 스트라이핑</span>하고, <span style="background-color:#fff5b1">패리티</span> 정보를 **분산**하여 모든 <span style="background-color:#fff5b1">디스크</span>에 저장합니다. 이는 패리티 디스크에 대한 병목 현상을 줄여주며, 성능과 데이터 보호 간의 균형이 좋습니다. 하나의 디스크가 고장 나더라도 패리티 정보를 통해 데이터를 복구할 수 있습니다. 그러나 하나의 디스크가 고장나면 데이터 복구 시간이 걸립니다. RAID 5는 성능과 데이터 보호가 모두 중요한 애플리케이션에서 주로 사용됩니다.

**RAID 6** <br>
RAID 6은 RAID 5와 유사하지만, <span style="background-color:#fff5b1">두 개의 패리티 블록</span>을 사용하여 두 개의 디스크가 동시에 고장 나더라도 데이터를 복구할 수 있습니다. 이는 매우 높은 신뢰성을 제공합니다. 그러나 추가적인 패리티 정보로 인해 쓰기 성능이 약간 저하될 수 있습니다. RAID 6은 매우 높은 신뢰성이 요구되는 환경에서 사용됩니다. RAID 수준 5보다 좀 더 신뢰성을 강화한 수준이나, 실제 널리 사용되지 않은 수준입니다.

RAID 0부터 RAID 6까지 각 레벨은 성능, 신뢰성, 저장 효율성 등의 측면에서 다양한 특성을 가지고 있습니다. 사용자의 요구에 따라 적절한 RAID 레벨을 선택하여 활용할 수 있습니다.

---
- **RAID 0**: 성능 향상, 데이터 보호 없음.
- **RAID 1**: 높은 신뢰성, 저장 공간 비효율적.
- **RAID 2**: 비트 수준 스트라이핑, 해밍 코드.
- **RAID 3**: 바이트 수준 스트라이핑, 패리티 디스크 병목.
- **RAID 4**: 블록 수준 스트라이핑, 패리티 디스크 병목.
- **RAID 5**: 블록 수준 스트라이핑, 분산 패리티, 성능과 보호 균형.
- **RAID 6**: 이중 분산 패리티, 매우 높은 신뢰성.
{: .notice--warning}

RAID의 목적과 사용 환경에 따라 적절한 RAID 레벨을 선택하는 것이 중요합니다. RAID는 데이터 보호와 성능 향상에 큰 도움이 되지만, 완벽한 데이터 보호를 위해서는 RAID와 함께 정기적인 백업도 필요합니다.

## Choice of RAID Levels
RAID 레벨을 선택할 때는 여러 가지 요소를 고려해야 합니다. 
가장 중요한 요소는 
- 금전적 비용, 
- 성능, 
- 고장 발생 시의 성능, 
- 고장 디스크 복구 시의 성능입니다. 
이러한 요소들은 각각의 RAID 레벨이 제공하는 특징 및 장단점에 따라 달라집니다.

<span style="background-color:#b3cf1f">RAID 0</span>은 데이터 스트라이핑을 통해 성능을 극대화하지만, **데이터 보호 기능이 전혀 없습니다.** 따라서 데이터 안전이 중요하지 않은 경우에만 사용됩니다. RAID 0은 주로 성능이 중요한 애플리케이션에서 사용되며, 데이터 손실 위험을 감수할 수 있는 경우에 적합합니다.

<span style="background-color:#b3cf1f">RAID 1</span>은 데이터를 두 개 이상의 디스크에 동일하게 복제하여 저장하는 미러링 방식을 사용합니다. 이는 높은 신뢰성을 제공하며, 디스크 중 하나가 고장 나더라도 다른 디스크에서 데이터를 복구할 수 있습니다. 그러나 RAID 1은 저장 공간의 효율성이 낮아서 **사용 가능한 저장 공간이 절반**으로 줄어들게 됩니다. RAID 1은 데이터 보호가 중요한 애플리케이션에서 주로 사용됩니다. 또한 RAID 1은 쓰기 성능이 RAID 5보다 훨씬 좋기 때문에, 높은 업데이트 빈도가 있는 환경 (예: 로그 디스크)에서 선호됩니다.

<span style="background-color:#b3cf1f">RAID 2와 RAID 4</span>는 각각 RAID 3과 RAID 5로 대체되어 **거의 사용되지 않습니다.** RAID 2는 비트 수준 스트라이핑과 해밍 코드를 사용하여 오류를 검출하고 수정하지만, **구현이 복잡**하고 **비용**이 많이 듭니다. RAID 4는 블록 수준 스트라이핑과 패리티 디스크를 사용하지만, 패리티 디스크가 병목 현상을 일으킬 수 있습니다.

<span style="background-color:#b3cf1f">RAID 3</span>은 바이트 수준 스트라이핑과 패리티 디스크를 사용하여 데이터를 보호하지만, 비트 스트라이핑이 단일 블록 읽기를 위해 모든 디스크 접근을 강요하여 **disk arm 이동을 낭비**합니다. 이로 인해 RAID 3은 **비효율적**이어서 현재는 거의 사용되지 않습니다. 대신 블록 스트라이핑을 사용하는 RAID 5가 이러한 문제를 피하고 더 널리 사용됩니다.

<span style="background-color:#b3cf1f">RAID 5</span>는 데이터를 블록 수준으로 스트라이핑하고, 패리티 정보를 분산하여 모든 디스크에 저장합니다. 이는 패리티 디스크에 대한 병목 현상을 줄여주며, **성능과 데이터 보호 간의 균형**이 좋습니다. RAID 5는 낮은 업데이트 빈도와 대량의 데이터가 있는 애플리케이션에 적합합니다. 대규모 저장소를 더 저렴하게 구성할 수 있다는 장점이 있습니다.

<span style="background-color:#b3cf1f">RAID 6</span>은 RAID 5와 유사하지만, 두 개의 패리티 블록을 사용하여 두 개의 디스크가 동시에 고장 나더라도 데이터를 복구할 수 있습니다. 이는 매우 높은 신뢰성을 제공하지만, 추**가적인 패리티 정보로 인해 쓰기 성능이 약간 저하**될 수 있습니다. RAID 6은 매우 높은 신뢰성이 요구되는 환경에서 사용되지만, 대부분의 애플리케이션에서는 RAID 1 또는 RAID 5가 충분한 안전성을 제공하기 때문에 잘 사용되지 않습니다.

결론적으로, RAID 레벨을 선택할 때는 <span style="background-color:#fff5b1">애플리케이션의 요구 사항과 데이터 보호, 성능, 비용 효율성</span> 등을 종합적으로 고려해야 합니다. 

RAID 0은 성능이 중요한 경우, 
RAID 1은 데이터 보호가 중요한 경우, 
RAID 5는 성능과 데이터 보호의 균형이 중요한 경우, 
RAID 6은 매우 높은 신뢰성이 필요한 경우에 적합합니다. 
RAID 2와 RAID 4는 거의 사용되지 않으며, RAID 3도 비효율성 때문에 사용되지 않습니다.
{: .notice}

## Software RAID vs. Hardware RAID
**소프트웨어 RAID**는 RAID 구현이 전적으로 소프트웨어에서 이루어지며, 특별한 하드웨어 지원이 필요 없습니다. 이는 운영 체제 수준에서 구현되며, 비용이 적게 들지만 CPU와 메모리를 많이 사용하게 되어 시스템 성능에 영향을 미칠 수 있습니다.

반면, **하드웨어 RAID**는 특별한 하드웨어를 통해 RAID를 구현합니다.
하드웨어 RAID는 비휘발성 메모리(NV-RAM)를 사용하여 실행 중인 쓰기 작업을 기록합니다. 전원 장애가 발생하면, 데이터 손상이 일어날 수 있습니다. 
> 예를 들어, 미러링 시스템에서 한 블록을 쓰고 두 번째 블록을 쓰기 전에 전원 장애가 발생하면, 이러한 손상된 데이터는 전원이 복구될 때 검출되어야 합니다. NV-RAM은 잠재적으로 손상된 블록을 효율적으로 검출하는 데 도움을 줍니다. (그렇지 않으면 모든 디스크 블록을 읽고 미러/패리티 블록과 비교해야 합니다)

## Hardware RAID Issues
하드웨어 RAID에서 발생할 수 있는 주요 이슈는 다음과 같습니다.

**Latent failure (bit rot)**
- 데이터가 시간이 지나면서 손상되는 현상으로, 이전에 성공적으로 기록된 데이터가 손상될 수 있습니다.
- 디스크 중 하나만 고장 나도 데이터 손실이 발생할 수 있습니다.

---
이를 해결하기 위한 기능들은 다음과 같습니다:
1. **Data scrubbing**:
    - 지속적으로 잠재적 실패를 스캔하고, 복사본이나 패리티 데이터를 통해 복구합니다.
    - 이는 데이터를 주기적으로 확인하고 오류를 수정하는 과정입니다.

2. **Hot swapping**:
    - 시스템이 작동 중일 때 전원을 끄지 않고 디스크를 교체하는 기능입니다.
    - 일부 하드웨어 RAID 시스템에서 지원하며, 복구 시간을 줄이고 시스템 가용성을 크게 향상시킵니다.

3. **Hot spare**:
    - 많은 시스템이 예비 디스크를 온라인 상태로 유지하며, 디스크 고장 시 이를 즉시 교체합니다.
    - 이를 핫 스페어라고 하며, 고장난 디스크를 자동으로 대체하여 데이터 보호를 강화합니다.

4. **단일 장애 지점 방지**:
    - 많은 RAID 시스템은 시스템의 작동을 중단시키지 않도록 단일 장애 지점을 방지합니다.
    - 이를 위해 배터리 백업이 있는 중복 전원 공급 장치, 다중 컨트롤러 및 다중 인터커넥션을 사용합니다.
{: .notice}
하드웨어 RAID는 데이터 손상 가능성을 줄이고, 복구 시간을 단축하며, 시스템의 가용성을 높이기 위해 여러 가지 방법을 사용합니다.